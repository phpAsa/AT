<extend name="Public/layout" />
<block name="head">

</block>
<block name="main">
        <!-- /. NAV SIDE  -->
        <div id="page-wrapper" >

            <div id="page-inner">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-action">
                                编辑用户
                            </div>
                            <div class="card-content">
                                <form class="col s12">
                                    <div class="row">
                                        <div class="input-field col s6">
                                            姓名:<input id="name" type="text" class="validate" value="{$info.name}">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="input-field col s6">
                                            昵称:<input id="nickname" type="text" class="validate" value="{$info.nickname}">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="select-field col s6">
                                            角色:<select class="form-control" id="depart">
                                            <option value="">选择角色</option>
                                            <foreach name="depart" item="v">
                                                <option <if condition="$v[id] eq $info[depart]">selected</if> value="{$v.id}">{$v['depart']}</option>
                                            </foreach>
                                        </select>
                                        </div>
                                    </div>
<!--                                    <div class="row">
                                        <div class="input-field col s6">
                                            性别:<input id="gender" type="text" class="validate">
                                        </div>
                                    </div>-->
                                    <div class="row">
                                        <div class="input-field col s6">
                                            性别:
                                            <p>
                                                <input name="gender" type="radio" <if condition="$info.gender eq 1">checked</if> value="1" id="test1" />
                                                <label for="test1">男</label>
                                            </p>
                                            <p>
                                                <input name="gender" type="radio" <if condition="$info.gender eq 2">checked</if>  value="2" id="test2" />
                                                <label for="test2">女</label>
                                            </p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="input-field col s6">
                                            民族:<input id="national" type="text" class="validate" value="{$info.national}">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="select-field col s6">
                                            部门:<select class="form-control" id="department">
                                            <option value="">选择部门</option>
                                            <foreach name="department" item="v">
                                                <option <if condition="$v[id] eq $info[department]">selected</if> value="{$v.id}">{$v['name']}</option>
                                            </foreach>
                                        </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="input-field col s6">
                                            职位:<input id="position" type="text" class="validate" value="{$info.position}">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="select-field col s6">
                                            员工关系:<select class="form-control" id="relation">
                                            <option value="">选择</option>
                                            <option <if condition="$info.relation eq '全日制合同工'">selected</if> value="全日制合同工">全日制合同工</option>
                                            <option <if condition="$info.relation eq '非全日制合同工'">selected</if> value="非全日制合同工">非全日制合同工</option>
                                            <option <if condition="$info.relation eq '实习生'">selected</if> value="实习生">实习生</option>
                                            <option <if condition="$info.relation eq '暑假工'">selected</if> value="暑假工">暑假工</option>
                                            <option <if condition="$info.relation eq '劳务派遣'">selected</if> value="劳务派遣">劳务派遣</option>
                                        </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="select-field col s6">
                                            员工级别:<select class="form-control" id="level">
                                            <option value="">选择级别</option>
                                            <foreach name="levels" item="v">
                                                <option <if condition="$v[id] eq $info[level]">selected</if> value="{$v.id}">{$v['level']}级</option>
                                            </foreach>
                                        </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="input-field col s6">
                                            手机号:<input id="phone" type="text" class="validate" value="{$info.phone}">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="input-field col s6">
                                            邮箱:<input id="email" type="text" class="validate" value="{$info.email}">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="input-field col s6">
                                            住址:<input id="address" type="text" class="validate" value="{$info.address}">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="input-field col s6">
                                            学历:<input id="school" type="text" class="validate" value="{$info.school}">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="input-field col s6">

                                            <div id="img">
                                                <img id="pic" src="{$info.pic}" width="200px;" pod="0">
                                            </div>
                                            <input id="myfile" type="file" multiple="" onclick="checkPod()"/>


                                        </div>
                                    </div>
                                    <div class="btn " role="group" aria-label="..." onclick="editMaster()">
                                        提交

                                    </div>
                                </form>
                                <div class="clearBoth"></div>
                            </div>
                        </div>
                    </div>
                 </div>

            </div>
             <!-- /. PAGE INNER  -->
        </div>


</block>
<block name="js">
    <script src="__PUBLIC__assets/js/filereader.js"></script>
    <script>
        $('#myfile').filereader({
            type:['jpg','jpeg','png'],
            max_size:1024,
            preview:$('#img'),
            success:function(){},
            preview_attr:{id:'pic', height:'200px'}
        });

        function checkPod() {
            $("#pic").attr("pod","1");
        }

    </script>
    <script type="text/javascript">
        function editMaster() {
            var id = "{$_GET['id']}";
            var name = $("#name").val();
            var nickname = $("#nickname").val();
            var gender = $('input[name="gender"]:checked').val();
            var national = $("#national").val();
            var position = $("#position").val();
            var phone = $("#phone").val();
            var email = $("#email").val();
            var address = $("#address").val();
            var school = $("#school").val();
            var depart = $("#depart").val();
            var relation = $("#relation").val();
            var department = $("#department").val();
            var levels = $("#level").val();
            var upPod = $("#pic").attr('pod');
            //console.log(upPod);return

            //console.log(pic);return
            if(!name) {
                layer.msg("姓名不能为空");return;
            }
            if(!phone) {
                layer.msg("手机号不能为空");return;
            }
            /*if(!depart) {
                layer.msg("部门不能为空");return;
            }*/
            if(!upPod) {
                var pic = $("#pic").attr('src');
                var data = {id:id,name:name,nickname:nickname,gender:gender,national:national,position:position,phone:phone,email:email,address:address,school:school,pic:pic,depart:depart,relation:relation,level_id:levels,department:department};
            } else {
                var data = {id:id,name:name,nickname:nickname,gender:gender,national:national,position:position,phone:phone,email:email,address:address,school:school,depart:depart,relation:relation,level_id:levels,department:department};
            }
            $.post("{:U('User/editUser')}",data,function(res) {
                if(res.err==1) {

                    location.href="{:U('User/index')}";
                } else {
                    layer.msg(res.msg);
                }
            });
        }
    </script>
</block>